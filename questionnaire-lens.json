{
  "resourceType": "Library",
  "id": "questionnaire-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "https://gravitate-health.lst.tfo.upm.es/ips/api/fhir/Library/592",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "questionnaire-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Interaction Lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]},
  "date": "2024-06-12T13:40:03.690Z",
  "title": "Interaction Lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente de Interacción"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de Interação"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Interaktionslinse"
          }
        ]
      }
    ]},
  "status": "draft",
  "experimental": true,
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "A lens that highlight any information related to interactions between other mediciones or ePIs",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Una lente que resalta cualquier información relacionada con interacciones entre otros medicamentos o ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Uma lente que destaca qualquer informação relacionada com interações entre outros medicamentos ou ePIs."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "En linse, der fremhæver al information relateret til interaktioner mellem andre lægemidler eller ePI'er."
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Clarify the important things related to interactions between other ePIs in the ePI provided",
   "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Aclarar los aspectos importantes relacionados con interacciones entre otros ePIs en el ePI proporcionado."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esclarecer os pontos importantes relacionados com interações entre outros ePIs no ePI fornecido."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Klargør de vigtige ting vedrørende interaktioner mellem andre ePI'er i den angivne ePI."
          }
        ]
      }
    ]
  },
  "usage": "This lens requires a preprocessed ePI, and an IPS to work. You can import this lens directly to your FHIR Server which suports Library Resource type.",
   "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Esta lente requiere una ePI preprocesada y un IPS para funcionar. Puedes importar esta lente directamente en tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Esta lente requer uma ePI pré-processada e um IPS para funcionar. Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Denne linse kræver en forbehandlet ePI og en IPS for at fungere. Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "data": "bGV0IHB2RGF0YSA9IHB2Ow0KbGV0IGh0bWxEYXRhID0gaHRtbDsNCg0KbGV0IGVwaURhdGEgPSBlcGk7DQpsZXQgaXBzRGF0YSA9IGlwczsNCg0KLy8gU3RhdGUgdG8gdHJhY2sgaWYgcXVlc3Rpb25uYWlyZSBsaW5rIHdhcyBhZGRlZA0KbGV0IGxpbmtBZGRlZCA9IGZhbHNlOw0KDQpsZXQgZ2V0U3BlY2lmaWNhdGlvbiA9ICgpID0+IHsNCiAgICByZXR1cm4gIjIuMC4zLXF1ZXN0aW9ubmFpcmUtYmFubmVyIjsNCn07DQovL2RvY3VtZW50LCBodG1sRGF0YSwgYmFubmVySFRNTA0KLy8NCmNvbnN0IGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rID0gKGxpc3RPZkNhdGVnb3JpZXMsIGxpbmtIVE1MLCBkb2N1bWVudCwgcmVzcG9uc2UpID0+IHsNCiAgICBsZXQgc2hvdWxkQXBwZW5kPWZhbHNlOyAvL2ZvciBmdXR1cmUgdXNhZ2UNCiAgICBsZXQgZm91bmRDYXRlZ29yeSA9IGZhbHNlOw0KICAgIGNvbnNvbGUubG9nKGxpc3RPZkNhdGVnb3JpZXMpDQogICAgY29uc29sZS5sb2cobGlzdE9mQ2F0ZWdvcmllcy5sZW5ndGgpDQogICAgbGlzdE9mQ2F0ZWdvcmllcy5mb3JFYWNoKChjbGFzc05hbWUpID0+IHsNCiAgICAgICAgaWYgKA0KICAgICAgICAgIHJlc3BvbnNlLmluY2x1ZGVzKGBjbGFzcz0iJHtjbGFzc05hbWV9YCkgfHwNCiAgICAgICAgICByZXNwb25zZS5pbmNsdWRlcyhgY2xhc3M9JyR7Y2xhc3NOYW1lfWApDQogICAgICAgICkgew0KICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc05hbWUpOw0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNvbnN0IGVsID0gZWxlbWVudHNbaV07DQogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOw0KICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImhyZWYiLCBsaW5rSFRNTCk7DQogICAgICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwgIl9ibGFuayIpOw0KICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoImNsYXNzIiwicXVlc3Rpb25uYWlyZS1sZW5zIik7DQogICAgICANCiAgICAgICAgICAgIGlmIChzaG91bGRBcHBlbmQpIHsNCiAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBsaW5rIGFzIGEgbmV3IGVsZW1lbnQgaW5zaWRlIHRoZSBleGlzdGluZyBlbGVtZW50DQogICAgICAgICAgICAgIGxpbmsuaW5uZXJIVE1MID0gIj3dIEZpbGwgb3V0IHNhZmV0eSBxdWVzdGlvbm5haXJlIjsNCiAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQobGluayk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAvLyBXcmFwIHRoZSBleGlzdGluZyBjb250ZW50cyBvZiB0aGUgZWxlbWVudCBpbiB0aGUgbGluaw0KICAgICAgICAgICAgICBsaW5rLmlubmVySFRNTCA9IGVsLmlubmVySFRNTDsNCiAgICAgICAgICAgICAgZWwuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGxpbmspOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBmb3VuZENhdGVnb3J5ID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICANCi8vVE9ETyBjaGVjayBsYW5ndWFnZSBsaWtlIChkaWFiZXRlcyBsZW5zKQ0KICAgIC8vIE5vIG1hdGNoaW5nIGNhdGVnb3J5IHRhZ3MgkiBpbmplY3QgYmFubmVyIGF0IHRvcA0KICAgIGlmICghZm91bmRDYXRlZ29yeSkgew0KICAgICAgICBjb25zdCBiYW5uZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgYmFubmVyRGl2LmlubmVySFRNTCA9IGANCiAgICAgICAgPGRpdiBjbGFzcz0iYWxlcnQtYmFubmVyIHF1ZXN0aW9ubmFpcmUtbGVucyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2ZmZGRkZDtwYWRkaW5nOjFlbTtib3JkZXI6MXB4IHNvbGlkICNmZjg4ODg7bWFyZ2luLWJvdHRvbToxZW07Ij4NCiAgICAgICAgICCgDyBUaGlzIG1lZGljYXRpb24gbWF5IGNhdXNlIGhpZ2gtcmlzayBzaWRlIGVmZmVjdHMuDQogICAgICAgICAgPGEgaHJlZj0iJHtsaW5rSFRNTH0iIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDFlbTsiPkZpbGwgb3V0IHNhZmV0eSBxdWVzdGlvbm5haXJlPC9hPg0KICAgICAgICA8L2Rpdj4NCiAgICAgIGA7DQoNCiAgICAgICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTsNCiAgICAgICAgaWYgKGJvZHkpIHsNCiAgICAgICAgICAgIGJvZHkuaW5zZXJ0QmVmb3JlKGJhbm5lckRpdiwgYm9keS5maXJzdENoaWxkKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENsZWFuIGhlYWQgKHNhbWUgYXMgeW91ciBvcmlnaW5hbCBsb2dpYykNCiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKS5sZW5ndGggPiAwKSB7DQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0ucmVtb3ZlKCk7DQogICAgfQ0KDQogICAgLy8gRXh0cmFjdCBIVE1MIHJlc3VsdA0KICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpLmxlbmd0aCA+IDApIHsNCiAgICAgICAgcmVzcG9uc2UgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmlubmVySFRNTDsNCiAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUwpOw0KICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7DQogICAgfQ0KDQogICAgaWYgKCFyZXNwb25zZSB8fCByZXNwb25zZS50cmltKCkgPT09ICIiKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiQW5ub3RhdGlvbiBwcm9jZXNzIGZhaWxlZDogZW1wdHkgb3IgbnVsbCByZXNwb25zZSIpOw0KICAgIH0NCg0KICAgIHJldHVybiByZXNwb25zZTsNCn07DQoNCmxldCBlbmhhbmNlID0gYXN5bmMgKCkgPT4gew0KDQogICAgaWYgKCFlcGlEYXRhIHx8ICFlcGlEYXRhLmVudHJ5IHx8IGVwaURhdGEuZW50cnkubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiZVBJIGlzIGVtcHR5IG9yIGludmFsaWQuIik7DQogICAgfQ0KICAgIGxldCBsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2ggPSBbImdyYXYtMyJdOyAvL3doYXQgdG8gbG9vayBpbiBleHRlbnNpb25zIC1tYWRlIHVwIGNvZGUgYmVjYXVzZSB0aGVyZSBpcyBub25lDQoNCiAgICAvLyBNYXRjaCBsaXN0cw0KICAgIGNvbnN0IEJVTkRMRV9JREVOVElGSUVSX0xJU1QgPSBbImVwaWJ1bmRsZS0xMjMiLCAiZXBpYnVuZGxlLWFiYyJdOw0KICAgIGNvbnN0IFBST0RVQ1RfSURFTlRJRklFUl9MSVNUID0gWyJDSVQtMjA0NDQ3IiwgIlJJUy0xOTczNjEiXTsNCg0KICAgIGNvbnN0IFFVRVNUSU9OTkFJUkVfVVJMID0gImh0dHBzOi8vZXhhbXBsZS5vcmcvcXVlc3Rpb25uYWlyZS9oaWdoLXJpc2siOw0KDQogICAgbGV0IG1hdGNoRm91bmQgPSBmYWxzZTsNCg0KICAgIC8vIENoZWNrIGJ1bmRsZS5pZGVudGlmaWVyLnZhbHVlDQogICAgaWYgKA0KICAgICAgICBlcGlEYXRhLmlkZW50aWZpZXIgJiYNCiAgICAgICAgQlVORExFX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhlcGlEYXRhLmlkZW50aWZpZXIudmFsdWUpDQogICAgKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCI9FyBNYXRjaGVkIGVQSSBCdW5kbGUuaWRlbnRpZmllcjoiLCBlcGlEYXRhLmlkZW50aWZpZXIudmFsdWUpOw0KICAgICAgICBtYXRjaEZvdW5kID0gdHJ1ZTsNCiAgICB9DQoNCiAgICAvLyBDaGVjayBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyLnZhbHVlDQogICAgZXBpRGF0YS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gew0KICAgICAgICBjb25zdCByZXMgPSBlbnRyeS5yZXNvdXJjZTsNCiAgICAgICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24iKSB7DQogICAgICAgICAgICBjb25zdCBpZHMgPSByZXMuaWRlbnRpZmllciB8fCBbXTsNCiAgICAgICAgICAgIGlkcy5mb3JFYWNoKChpZCkgPT4gew0KICAgICAgICAgICAgICAgIGlmIChQUk9EVUNUX0lERU5USUZJRVJfTElTVC5pbmNsdWRlcyhpZC52YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIj2KIE1hdGNoZWQgTWVkaWNpbmFsUHJvZHVjdERlZmluaXRpb24uaWRlbnRpZmllcjoiLCBpZC52YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvLyBlUEkgdHJhc2xhdGlvbiBmcm9tIHRlcm1pbm9sb2d5IGNvZGVzIHRvIHRoZWlyIGh1bWFuIHJlZGFibGUgdHJhbnNsYXRpb25zIGluIHRoZSBzZWN0aW9ucw0KICAgIC8vIGluIHRoaXMgY2FzZSwgaWYgaXMgZG9lcyBub3QgZmluZCBhIHBsYWNlLCBhZGRzIGl0IHRvIHRoZSB0b3Agb2YgdGhlIGVQSQ0KICAgIGxldCBjb21wb3NpdGlvbnMgPSAwOw0KICAgIGxldCBjYXRlZ29yaWVzID0gW107DQogICAgZXBpLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7DQogICAgICAgIGlmIChlbnRyeS5yZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT0gIkNvbXBvc2l0aW9uIikgew0KICAgICAgICAgICAgY29tcG9zaXRpb25zKys7DQogICAgICAgICAgICAvL0l0ZXJhdGVkIHRocm91Z2ggdGhlIENvbmRpdGlvbiBlbGVtZW50IHNlYXJjaGluZyBmb3IgY29uZGl0aW9ucw0KICAgICAgICAgICAgZW50cnkucmVzb3VyY2UuZXh0ZW5zaW9uLmZvckVhY2goKGVsZW1lbnQpID0+IHsNCg0KICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBwb3NpdGlvbiBvZiB0aGUgZXh0ZW5zaW9uWzFdIGlzIGNvcnJlY3QNCiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5leHRlbnNpb25bMV0udXJsID09ICJjb25jZXB0Iikgew0KICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggdGhyb3VnaCB0aGUgZGlmZmVyZW50IHRlcm1pbm9sb2dpZXMgdGhhdCBtYXkgYmUgYXZhaWJsZSB0byBjaGVjayBpbiB0aGUgY29uZGl0aW9uDQogICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmV4dGVuc2lvblsxXS52YWx1ZUNvZGVhYmxlUmVmZXJlbmNlLmNvbmNlcHQuY29kaW5nLmZvckVhY2goDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXh0ZW5zaW9uOiAiICsgZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcgKyAiOiIgKyBjb2RpbmcuY29kZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvZGUgaXMgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcyB0byBzZWFyY2gNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaC5pbmNsdWRlcyhjb2RpbmcuY29kZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBpcyBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMucHVzaChlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICBpZiAoY29tcG9zaXRpb25zID09IDApIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgZVBJOiBubyBjYXRlZ29yeSAiQ29tcG9zaXRpb24iIGZvdW5kJyk7DQogICAgfQ0KDQogICAgaWYgKCFtYXRjaEZvdW5kKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJlUEkgaXMgbm90IGZvciBhIGhpZ2gtcmlzayBzaWRlIGVmZmVjdCBtZWRpY2F0aW9uIik7DQogICAgICAgIGxpbmtBZGRlZCA9IGZhbHNlOw0KICAgICAgICByZXR1cm4gaHRtbERhdGE7DQogICAgfQ0KDQogICAgZWxzZSB7DQogICAgICAgIGxpbmtBZGRlZCA9IHRydWU7DQoNCiAgICAgICAgbGV0IHJlc3BvbnNlID0gaHRtbERhdGE7DQogICAgICAgIGxldCBkb2N1bWVudDsNCg0KICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsNCiAgICAgICAgICAgIGxldCB7IEpTRE9NIH0gPSBqc2RvbTsNCiAgICAgICAgICAgIGxldCBkb20gPSBuZXcgSlNET00oaHRtbERhdGEpOw0KICAgICAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50Ow0KICAgICAgICAgICAgcmV0dXJuIGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rKGNhdGVnb3JpZXMsIFFVRVNUSU9OTkFJUkVfVVJMLCBkb2N1bWVudCwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgLy9saXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50Ow0KICAgICAgICAgICAgcmV0dXJuIGluc2VydFF1ZXN0aW9ubmFpcmVMaW5rKGNhdGVnb3JpZXMsIFFVRVNUSU9OTkFJUkVfVVJMLCBkb2N1bWVudCwgcmVzcG9uc2UpOw0KICAgICAgICB9DQogICAgfTsNCn07DQoNCmxldCBleHBsYW5hdGlvbiA9ICgpID0+IHsNCiAgICAvLyBFeHRyYWN0IGxhbmd1YWdlIGZyb20gZVBJDQogICAgbGV0IGxhbmd1YWdlID0gImVuIjsgLy8gZGVmYXVsdCB0byBFbmdsaXNoDQogICAgaWYgKGVwaURhdGEgJiYgZXBpRGF0YS5sYW5ndWFnZSkgew0KICAgICAgICBsYW5ndWFnZSA9IGVwaURhdGEubGFuZ3VhZ2UudG9Mb3dlckNhc2UoKTsNCiAgICB9DQoNCiAgICAvLyBTaW1wbGUsIHBhdGllbnQtZnJpZW5kbHkgZXhwbGFuYXRpb25zIGluIGRpZmZlcmVudCBsYW5ndWFnZXMNCiAgICBjb25zdCBleHBsYW5hdGlvbnNBZGRlZCA9IHsNCiAgICAgICAgZW46ICJBIGxpbmsgdG8gYSBzYWZldHkgcXVlc3Rpb25uYWlyZSBoYXMgYmVlbiBhZGRlZCB0byBoZWxwIHlvdSBhc3Nlc3MgaWYgdGhpcyBtZWRpY2F0aW9uIGlzIHNhZmUgZm9yIHlvdS4iLA0KICAgICAgICBlczogIlNlIGhhIGHxYWRpZG8gdW4gZW5sYWNlIGEgdW4gY3Vlc3Rpb25hcmlvIGRlIHNlZ3VyaWRhZCBwYXJhIGF5dWRhcmxlIGEgZXZhbHVhciBzaSBlc3RlIG1lZGljYW1lbnRvIGVzIHNlZ3VybyBwYXJhIHVzdGVkLiIsDQogICAgICAgIGZyOiAiVW4gbGllbiB2ZXJzIHVuIHF1ZXN0aW9ubmFpcmUgZGUgc+ljdXJpdOkgYSDpdOkgYWpvdXTpIHBvdXIgdm91cyBhaWRlciDgIOl2YWx1ZXIgc2kgY2UgbelkaWNhbWVudCBlc3Qgc/tyIHBvdXIgdm91cy4iLA0KICAgICAgICBkZTogIkVpbiBMaW5rIHp1IGVpbmVtIFNpY2hlcmhlaXRzZnJhZ2Vib2dlbiB3dXJkZSBoaW56dWdlZvxndCwgdW0gSWhuZW4genUgaGVsZmVuIGZlc3R6dXN0ZWxsZW4sIG9iIGRpZXNlcyBNZWRpa2FtZW50IGb8ciBTaWUgc2ljaGVyIGlzdC4iLA0KICAgICAgICBpdDogIsggc3RhdG8gYWdnaXVudG8gdW4gY29sbGVnYW1lbnRvIGEgdW4gcXVlc3Rpb25hcmlvIGRpIHNpY3VyZXp6YSBwZXIgYWl1dGFydGkgYSB2YWx1dGFyZSBzZSBxdWVzdG8gZmFybWFjbyDoIHNpY3VybyBwZXIgdGUuIiwNCiAgICAgICAgcHQ6ICJGb2kgYWRpY2lvbmFkbyB1bSBsaW5rIHBhcmEgdW0gcXVlc3Rpb27hcmlvIGRlIHNlZ3VyYW7nYSBwYXJhIGFqdWThLWxvIGEgYXZhbGlhciBzZSBlc3RlIG1lZGljYW1lbnRvIOkgc2VndXJvIHBhcmEgdm9j6i4iLA0KICAgICAgICBubDogIkVyIGlzIGVlbiBsaW5rIG5hYXIgZWVuIHZlaWxpZ2hlaWRzdnJhZ2VubGlqc3QgdG9lZ2V2b2VnZCBvbSB1IHRlIGhlbHBlbiBiZW9vcmRlbGVuIG9mIGRpdCBtZWRpY2lqbiB2ZWlsaWcgdm9vciB1IGlzLiINCiAgICB9Ow0KDQogICAgY29uc3QgZXhwbGFuYXRpb25zTm90QWRkZWQgPSB7DQogICAgICAgIGVuOiAiWW91ciBwcm9maWxlIGRvZXMgbm90IG1hdGNoIHRoZSBjb25kaXRpb25zIHRvIGFkZCBhIHF1ZXN0aW9ubmFpcmUgbGluay4iLA0KICAgICAgICBlczogIlN1IHBlcmZpbCBubyBjb2luY2lkZSBjb24gbGFzIGNvbmRpY2lvbmVzIHBhcmEgYfFhZGlyIHVuIGVubGFjZSBhbCBjdWVzdGlvbmFyaW8uIiwNCiAgICAgICAgZnI6ICJWb3RyZSBwcm9maWwgbmUgY29ycmVzcG9uZCBwYXMgYXV4IGNvbmRpdGlvbnMgcG91ciBham91dGVyIHVuIGxpZW4gdmVycyBsZSBxdWVzdGlvbm5haXJlLiIsDQogICAgICAgIGRlOiAiSWhyIFByb2ZpbCBlcmb8bGx0IG5pY2h0IGRpZSBCZWRpbmd1bmdlbiBm/HIgZGFzIEhpbnp1ZvxnZW4gZWluZXMgRnJhZ2Vib2dlbi1MaW5rcy4iLA0KICAgICAgICBpdDogIklsIHR1byBwcm9maWxvIG5vbiBjb3JyaXNwb25kZSBhbGxlIGNvbmRpemlvbmkgcGVyIGFnZ2l1bmdlcmUgdW4gY29sbGVnYW1lbnRvIGFsIHF1ZXN0aW9uYXJpby4iLA0KICAgICAgICBwdDogIlNldSBwZXJmaWwgbuNvIGNvcnJlc3BvbmRlIOBzIGNvbmRp5/VlcyBwYXJhIGFkaWNpb25hciB1bSBsaW5rIHBhcmEgbyBxdWVzdGlvbuFyaW8uIiwNCiAgICAgICAgbmw6ICJVdyBwcm9maWVsIHZvbGRvZXQgbmlldCBhYW4gZGUgdm9vcndhYXJkZW4gb20gZWVuIHZyYWdlbmxpanN0bGluayB0b2UgdGUgdm9lZ2VuLiINCiAgICB9Ow0KDQogICAgLy8gUmV0dXJuIGV4cGxhbmF0aW9uIGJhc2VkIG9uIHdoZXRoZXIgbGluayB3YXMgYWRkZWQsIGluIHRoZSBlUEkgbGFuZ3VhZ2UNCiAgICBpZiAobGlua0FkZGVkKSB7DQogICAgICAgIHJldHVybiBleHBsYW5hdGlvbnNBZGRlZFtsYW5ndWFnZV0gfHwgZXhwbGFuYXRpb25zQWRkZWQuZW47DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGV4cGxhbmF0aW9uc05vdEFkZGVkW2xhbmd1YWdlXSB8fCBleHBsYW5hdGlvbnNOb3RBZGRlZC5lbjsNCiAgICB9DQp9Ow0KDQpyZXR1cm4gew0KICAgIGVuaGFuY2U6IGVuaGFuY2UsDQogICAgZ2V0U3BlY2lmaWNhdGlvbjogZ2V0U3BlY2lmaWNhdGlvbiwNCiAgICBleHBsYW5hdGlvbjogZXhwbGFuYXRpb24sDQp9Ow0K"
    }
  ]
}
